root@rk3568-buildroot:/userdata# ./test_gpio_mapping.sh 
========================================
RK3568 GPIO Pin Mapping Test Script
========================================
1. Check GPIO subsystem information:
GPIO sysfs interface available
total 0
drwxr-xr-x  2 root root    0 May 20 13:35 .
drwxr-xr-x 75 root root    0 May 20 13:35 ..
--w-------  1 root root 4096 May 20 13:58 export
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip0 -> ../../devices/platform/pinctrl/fdd60000.gpio0/gpio/gpiochip0
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip128 -> ../../devices/platform/pinctrl/fe770000.gpio4/gpio/gpiochip128
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip32 -> ../../devices/platform/pinctrl/fe740000.gpio1/gpio/gpiochip32
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip511 -> ../../devices/platform/fdd40000.i2c/i2c-0/0-0020/rk805-pinctrl/gpio/gpiochip511
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip64 -> ../../devices/platform/pinctrl/fe750000.gpio2/gpio/gpiochip64
lrwxrwxrwx  1 root root    0 May 20 13:35 gpiochip96 -> ../../devices/platform/pinctrl/fe760000.gpio3/gpio/gpiochip96
--w-------  1 root root 4096 May 20 13:58 unexport

2. Check GPIO information in device tree:

3. Check existing GPIO exports:
Exported GPIOs:

4. Check pinctrl usage for our pins:
Checking if A21/U3/AF2 pins are used by pinctrl...
Pinctrl debug info available:
Searching for our pins in pinctrl maps...
pin gpio0-24
pin gpio0-25
pin gpio3-13
pin gpio3-21
pin gpio3-16
pin gpio3-15
pin gpio3-1
pin gpio3-19
pin gpio3-18
pin gpio3-17

5. Test specific GPIO numbers with detailed feedback:

Testing A21 (GPIO0_C4_d) -> GPIO 16:
  Attempting to export GPIO 16...
  ✓ GPIO 16 exported successfully
  ✓ Direction set to output
  ✓ Set HIGH, read: 1
  ✓ Set LOW, read: 0
  ✓ GPIO 16 unexported

Testing AF2 (GPIO3_B2_d) -> GPIO 106:
  Attempting to export GPIO 106...
  ✓ GPIO 106 exported successfully
  ✓ Direction set to output
  ✓ Set HIGH, read: 1
  ✓ Set LOW, read: 0
  ✓ GPIO 106 unexported

Testing U3 (GPIO4_C0_d) -> GPIO 144:
  Attempting to export GPIO 144...
  ✓ GPIO 144 exported successfully
  ✓ Direction set to output
  ✓ Set HIGH, read: 1
  ✓ Set LOW, read: 0
  ✓ GPIO 144 unexported

6. Alternative GPIO numbers to try:
If the calculated numbers don't work, try these alternatives:
GPIO0 group (0-31):
  GPIO16 (GPIO0 group)
  GPIO17 (GPIO0 group)
  GPIO18 (GPIO0 group)
  GPIO19 (GPIO0 group)
  GPIO20 (GPIO0 group)
GPIO3 group (96-127):
  GPIO104 (GPIO3 group)
  GPIO105 (GPIO3 group)
  GPIO106 (GPIO3 group)
  GPIO107 (GPIO3 group)
  GPIO108 (GPIO3 group)
GPIO4 group (128-159):
  GPIO140 (GPIO4 group)
  GPIO141 (GPIO4 group)
  GPIO142 (GPIO4 group)
  GPIO143 (GPIO4 group)
  GPIO144 (GPIO4 group)

7. Manual testing commands:
You can manually test any GPIO number with these commands:
  echo N > /sys/class/gpio/export          # Replace N with GPIO number
  echo out > /sys/class/gpio/gpioN/direction
  echo 1 > /sys/class/gpio/gpioN/value     # Set HIGH
  echo 0 > /sys/class/gpio/gpioN/value     # Set LOW
  cat /sys/class/gpio/gpioN/value          # Read current value
  echo N > /sys/class/gpio/unexport        # Cleanup

8. Pinctrl information (if available):
Available pinctrl devices:
total 0
drwxr-xr-x  4 root root 0 Jan  1  1970 .
drwx------ 42 root root 0 Jan  1  1970 ..
-r--r--r--  1 root root 0 Jan  1  1970 pinctrl-devices
-r--r--r--  1 root root 0 Jan  1  1970 pinctrl-handles
-r--r--r--  1 root root 0 Jan  1  1970 pinctrl-maps
drwxr-xr-x  2 root root 0 Jan  1  1970 pinctrl-rockchip-pinctrl
drwxr-xr-x  2 root root 0 Jan  1  1970 rk805-pinctrl-rk817-pinctrl

========================================
Test completed
========================================
root@rk3568-buildroot:/userdata# 