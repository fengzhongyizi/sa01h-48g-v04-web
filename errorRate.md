# Error Rate 信号监控功能详细说明

## 1. 功能概述

Error Rate页面是一个**信号质量监控系统**，用于长时间监控HDMI信号的稳定性和可靠性。它可以记录信号中断、信号丢失或图像异常的时间点，帮助分析信号传输过程中的问题。

## 2. 主要组件说明

### 2.1 时间槽概念
- **时间槽(Time Slot)**: 监控的基本时间单位
- **总槽位数**: 最大支持2040个时间槽
- **时间间隔**: 每个时间槽可设置1-255秒或分钟
- **槽位编号**: 采用批次号格式，如0001、0101、0201等

### 2.2 监控原理
系统会按照设定的时间间隔，定期检查信号状态：
- **正常状态**: 信号稳定，图像正常 → 记录为0
- **异常状态**: 信号丢失或图像异常 → 记录为1

## 3. 界面功能详解

### 3.1 New Start 按钮
**功能**: 开始新的监控任务

**点击后发生的事情**:
1. 记录当前时间作为监控开始时间
2. 清空历史监控数据
3. 向MCU发送开始监控命令(具体指令待定)
4. 开始按设定的时间间隔进行信号检测
5. 启动数据采集和记录流程

**MCU通信**:
```
发送指令: START SIGNAL MONITOR [时间间隔] [时间单位] [触发模式]\r\n
例如: START SIGNAL MONITOR 5 SECONDS 1\r\n
```

### 3.2 时间槽设置 (Time Slot Setting)

#### 时间间隔设置
- **范围**: 1-255
- **含义**: 每个时间槽的持续时间
- **操作**: 
  - 点击数字框可调出数字键盘
  - 点击上下箭头微调数值
  - 长按箭头可连续调整

#### 时间单位选择
- **秒(Seconds)**: 时间槽以秒为单位
- **分钟(Minutes)**: 时间槽以分钟为单位

**示例**: 
- 设置"5秒": 每5秒检查一次信号状态
- 设置"2分钟": 每2分钟检查一次信号状态

### 3.3 触发模式 (Trigger Mode)

#### 模式1: "By frame image difference and loss of signal"
**含义**: 通过帧图像差异和信号丢失进行触发

**检测内容**:
1. **信号丢失检测**: 检查是否有HDMI信号输入
2. **图像差异检测**: 比较前后帧图像的差异
3. **综合判断**: 任一条件触发都记录为异常

**适用场景**: 
- 需要检测信号中断
- 需要检测图像内容异常变化
- 全面的信号质量监控

**触发条件**:
- 信号完全丢失 → 记录1
- 图像发生显著变化(可能表示信号不稳定) → 记录1
- 信号正常且图像稳定 → 记录0

#### 模式2: "Loss of signal only"
**含义**: 仅检测信号丢失

**检测内容**:
1. **信号丢失检测**: 只检查是否有HDMI信号输入
2. **忽略图像内容**: 不关心图像内容变化

**适用场景**:
- 只关心信号连接状态
- 忽略正常的图像内容变化
- 基础的信号连通性监控

**触发条件**:
- 信号完全丢失 → 记录1  
- 有信号输入(无论图像内容) → 记录0

### 3.4 数据显示表格

#### 表格结构
- **行标签**: 批次号(0001, 0101, 0201...)
- **列**: 每列代表一个时间槽(1-100)
- **网格**: 20行×100列，总共2000个基础槽位

#### 数据含义
- **显示"1"**: 该时间槽检测到异常
  - 信号丢失
  - 图像异常变化(取决于触发模式)
  - 通信错误
  
- **显示"0"或空白**: 该时间槽正常
  - 信号稳定
  - 图像正常
  - 未检测到异常

#### 批次号规则
```
行1: 0001 → 槽位 0-99
行2: 0101 → 槽位 100-199  
行3: 0201 → 槽位 200-299
...
行20: 1901 → 槽位 1900-1999
```

### 3.5 控制按钮

#### Stop 按钮
- **功能**: 停止当前监控
- **操作**: 停止数据采集，保留已记录数据
- **MCU指令**: `STOP SIGNAL MONITOR\r\n`

#### Clear Data 按钮  
- **功能**: 清除所有监控数据
- **操作**: 清空表格显示，重置计数器
- **注意**: 不影响正在进行的监控

## 4. MCU通信协议

### 4.1 命令格式
```
开始监控: START SIGNAL MONITOR [间隔] [单位] [模式]\r\n
停止监控: STOP SIGNAL MONITOR\r\n
查询状态: GET SIGNAL MONITOR STATUS\r\n
```

### 4.2 数据接收格式
MCU返回的监控数据格式(假设):
```
SIGNAL_SLOT [槽位编号] [状态] [时间戳]\r\n

例如:
SIGNAL_SLOT 0001 1 14:30:25\r\n  // 槽位1异常
SIGNAL_SLOT 0002 0 14:30:30\r\n  // 槽位2正常
```

### 4.3 状态码定义
- **0**: 信号正常
- **1**: 信号异常/丢失
- **2**: 通信错误  
- **3**: 设备错误

## 5. 实际应用场景

### 5.1 信号稳定性测试
**设置**: 1秒间隔，信号丢失模式
**目的**: 测试长时间信号传输的稳定性
**观察**: 记录信号中断的频率和时间点

### 5.2 图像质量监控
**设置**: 5秒间隔，图像差异+信号丢失模式  
**目的**: 监控图像传输质量
**观察**: 记录图像异常和信号问题

### 5.3 设备老化测试
**设置**: 1分钟间隔，连续监控数小时
**目的**: 评估设备长期工作稳定性
**观察**: 分析错误分布模式

## 6. 数据分析说明

### 6.1 正常模式
表格大部分区域为空白或0，偶尔出现少量1

### 6.2 间歇性问题  
表格中1呈现有规律的分布模式

### 6.3 严重问题
表格中连续出现大量1，表示信号严重不稳定

## 7. 注意事项

1. **最大槽位限制**: 达到2040个槽位后需要清除数据才能继续
2. **MCU固件依赖**: 需要MCU固件支持相应的监控指令
3. **时间精度**: 实际监控精度取决于MCU的定时器精度
4. **数据保存**: 切换页面不会丢失监控数据，但关闭应用会丢失

## 8. 故障排除

### 8.1 无法开始监控
- 检查MCU连接状态
- 确认MCU固件版本
- 查看UART5通信状态

### 8.2 数据显示异常
- 检查串口数据格式
- 确认MCU响应格式
- 查看调试日志

### 8.3 监控停止
- 检查串口连接
- 确认时间槽设置合理
- 查看设备状态 